"use strict";(()=>{var e={};e.id=145,e.ids=[145],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},7561:e=>{e.exports=require("node:fs")},4492:e=>{e.exports=require("node:stream")},2477:e=>{e.exports=require("node:stream/web")},1017:e=>{e.exports=require("path")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},1267:e=>{e.exports=require("worker_threads")},9796:e=>{e.exports=require("zlib")},7671:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>b,originalPathname:()=>v,patchFetch:()=>E,requestAsyncStorage:()=>m,routeModule:()=>h,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>x});var n={};r.r(n),r.d(n,{POST:()=>d,runtime:()=>l});var a=r(5419),i=r(9108),s=r(9678),o=r(8070),u=r(5683),p=r(6700),c=r(5752);let l="nodejs";async function d(e){(0,c.V1)(["OPENAI_API_KEY","SUPABASE_URL","SUPABASE_SERVICE_KEY"]);let{message:t}=await e.json();if(!t)return o.Z.json({error:"message required"},{status:400});let r=await (0,u.D)(t,4),n=(0,c.aZ)(r),a=await (0,p.X)([{role:"system",content:"You are a volleyball officiating tutor. Answer concisely with rule citations. Use provided snippets as ground truth."},{role:"user",content:`User question: ${t}

Rule snippets:
${n}`}]);return o.Z.json({answer:a,references:r})}let h=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/chatbot/route",pathname:"/api/chatbot",filename:"route",bundlePath:"app/api/chatbot/route"},resolvedPagePath:"/Users/harrisonwang/ovafinal/app/api/chatbot/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:g,headerHooks:b,staticGenerationBailout:x}=h,v="/api/chatbot/route";function E(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},7399:(e,t,r)=>{r.d(t,{OC:()=>i,UI:()=>s});let n=new(r(6168)).ZP({apiKey:process.env.OPENAI_API_KEY}),a="text-embedding-3-small";async function i(e){let t=e.replace(/\n/g," ");return(await n.embeddings.create({model:a,input:t})).data[0].embedding}async function s(e){return(await n.embeddings.create({model:a,input:e.map(e=>e.replace(/\n/g," "))})).data.map(e=>e.embedding)}},6700:(e,t,r)=>{r.d(t,{X:()=>a});let n=new(r(6168)).ZP({apiKey:process.env.OPENAI_API_KEY});async function a(e,t="gpt-4o-mini",r={}){let{temperature:a=.7,maxTokens:i}=r,s=await n.chat.completions.create({model:t,messages:e,temperature:a,...i&&{max_tokens:i}});return s.choices[0]?.message?.content??""}},5683:(e,t,r)=>{r.d(t,{D:()=>s,k:()=>i});var n=r(7399),a=r(8234);function i(e,t=800,r=80){let n=e.split(/\s+/),a=[],i=0;for(;i<n.length;){let e=n.slice(i,i+t).join(" ");a.push(e),i+=t-r}return a}async function s(e,t=5){let r=(0,a.b)(),i=await (0,n.OC)(e),{data:s,error:o}=await r.rpc("match_rules",{query_embedding:i,match_count:t});if(o)throw o;return s||[]}},8234:(e,t,r)=>{r.d(t,{b:()=>s});var n=r(7493);let a="https://uglzhvquiarxyahsnesj.supabase.co",i=process.env.SUPABASE_SERVICE_KEY,s=()=>{if(!a||!i)throw Error("Supabase environment variables missing (SUPABASE_URL, SUPABASE_SERVICE_KEY).");return(0,n.eI)(a,i,{global:{headers:{"x-client-info":"volleyball-ref-training"}},auth:{autoRefreshToken:!1,detectSessionInUrl:!1,persistSession:!1}})}},5752:(e,t,r)=>{function n(e){switch(e){case"easy":return 3;case"medium":return 4;case"hard":return 5;default:return 6}}function a(e){return e.map((e,t)=>`Rule Snippet ${t+1}${e.similarity?` (sim ${e.similarity.toFixed(2)})`:""}:
${e.chunk}`).join("\n\n")}function i(e){let t=e.filter(e=>!process.env[e]);if(t.length)throw Error(`Missing environment variables: ${t.join(", ")}`)}r.d(t,{V1:()=>i,aZ:()=>a,uF:()=>n})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[638,164,168],()=>r(7671));module.exports=n})();